const mongoose = require('mongoose');
const { isEmail } = require('validator');
const { ObjectId } = mongoose.Schema.Types;
const bcrypt = require('bcrypt');
const userSchema = new mongoose.Schema({
    name: {
        type: String,
        required: true
    },
    email: {
        type: String,
        required: true
    },
    password: {
        type: String,
        required: true
    },
    isVerified: {
        type: Boolean,
        default: true
    },
    token: String,
    expireToken: Date,
    pic: {
        type: String,
        default: "data:image/jpeg;base64,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"
    },
    followers: [{ type: ObjectId, ref: "User" }],
    following: [{ type: ObjectId, ref: "User" }]
})

userSchema.pre('save', function (next) {
    var user = this;
    if (!user.isModified('password')) {
        return next();
    }
    bcrypt.hash(user.password, 10, function (err, hash) {
        if (err) {
            return next(err);
        }
        user.password = hash;
        next();
    });
});


userSchema.methods.comparePassword = function (candidatePassword,cb) {
    bcrypt.compare(candidatePassword, this.password, (err, res) => {
        if(err){
            return cb(err);
        }
        cb(null,res);
    })
};

module.exports = mongoose.model("User", userSchema);